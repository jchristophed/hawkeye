{% extends "layouts.app" %}

{% set nb_empty_flats_relet = 0 %}
{% set nb_empty_flats_not_relet = 0 %}

{% block breadcrumb %}

    <li class="active">{{ trans('global.app.dashboard') }}</li>

{% endblock %}

{% block content %}

    <div class="row text-center" style="margin-bottom: 40px">
        <div class="col-sm-4">
            <h4>{{ trans_choice('global.flat.title', 2) }}</h4>
            <canvas id="myChart" height="200"></canvas>

        </div>

        <div class="col-sm-4">
            <h4>{{ trans_choice('global.tenant.title', 2) }}</h4>
            <canvas id="myChart3" height="200"></canvas>

        </div>

        <div class="col-sm-4">
            <h4>{{ trans_choice('global.contract.title', 2) }}</h4>
            <canvas id="myChart2" height="200"></canvas>

        </div>

    </div>
    <div class="clearfix"></div>

    <div class="row">

        <div class="col-sm-4">
            <div class="panel panel-danger">
                <div class="panel-heading">{{ trans_choice('global.flat.title', 2) }} {{ trans_choice('global.flat.empty_not_relet', 2) | lower }}</div>
                <table class="table text-center">

                    <thead>
                        <tr>
                            <th class="text-center">#</th>
                            <th class="text-center">{{ trans('global.lbl.num') }}</th>
                            <th class="text-center">{{ trans('global.flat.price') }}</th>
                            <th class="text-center">{{ trans('global.flat.area') }}</th>
                            <th class="text-center"></th>
                        </tr>
                    </thead>

                    {% for flat in flats if flat.next_contract.id is empty %}

                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ flat.name }}</td>
                            <td>{{ flat.full_price }}</td>
                            <td>{{ flat.full_area }}</td>
                            <td>
                                <a href="{{ route('residence.flat.show', [residence.id, flat.id]) }}" title="{{ trans('global.lbl.show') }}" class="btn btn-xs btn-default pull-right">{{ trans('global.lbl.show') }}</a>
                            </td>
                        </tr>

                        {% set nb_empty_flats_not_relet = loop.index %}

                    {% else %}

                        <tr>
                            <td colspan="8" class="text-danger">{{ trans('global.flat.no_empty') }}</td>
                        </tr>

                    {% endfor %}

                </table>
            </div>
        </div>

        <div class="col-sm-4">
            <div class="panel panel-warning">
                <div class="panel-heading">{{ trans_choice('global.flat.title', 2) }} {{ trans_choice('global.flat.empty_relet', 2) | lower }}</div>
                <table class="table text-center">

                    <thead>
                    <tr>
                        <th class="text-center">#</th>
                        <th class="text-center">{{ trans('global.lbl.num') }}</th>
                        <th class="text-center">{{ trans('global.flat.price') }}</th>
                        <th class="text-center">{{ trans('global.contract.deadline') }}</th>
                        <th class="text-center"></th>
                    </tr>
                    </thead>

                    {% for flat in flats if flat.next_contract.id is not empty %}

                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ flat.name }}</td>
                            <td>{{ flat.full_price }}</td>
                            <td>
                                {% if flat.contract.id is not empty and flat.contract.end_date != '0000-00-00' %}<a href="{{ route('residence.contract.show', [residence.id, flat.contract.id]) }}" class="label label-danger" style="text-decoration: none">{{ trans('global.flat.end') }} {{ flat.contract.end_date | date('d/m/y') }}</a>{% endif %}
                                {% if flat.next_contract.id is not empty %}<a href="{{ route('residence.contract.show', [residence.id, flat.next_contract.id]) }}" class="label label-success" style="text-decoration: none">{{ trans('global.flat.relet') }} {{ flat.next_contract.start_date | date('d/m/y') }}</a>{% endif %}
                            </td>
                            <td>
                                <a href="{{ route('residence.flat.show', [residence.id, flat.id]) }}" title="{{ trans('global.lbl.show') }}" class="btn btn-xs btn-default pull-right">{{ trans('global.lbl.show') }}</a>
                            </td>
                        </tr>

                        {% set nb_empty_flats_relet = loop.index %}

                    {% else %}

                        <tr>
                            <td colspan="8" class="text-danger">{{ trans('global.flat.no_relet') }}</td>
                        </tr>

                    {% endfor %}

                </table>
            </div>
        </div>

        <div class="col-sm-4">

            <div class="panel panel-default">
                <div class="panel-heading">{{ trans_choice('global.contract.book', 2) }}</div>
                <table class="table text-center">

                    <thead>
                    <tr>
                        <th class="text-center">#</th>
                        <th class="text-center">{{ trans_choice('global.flat.title', 1) }}</th>
                        <th class="text-center">{{ trans_choice('global.tenant.title', 1) }}</th>
                        <th class="text-center"></th>
                    </tr>
                    </thead>

                    {% for contract in booked_contracts if booked_contracts is not empty%}

                        <tr>
                            <td>{{ loop.index }}</td>
                            <td><a href="{{ route('residence.flat.show', [residence.id, contract.flat.id]) }}" title="{{ contract.flat.name }}">{{ contract.flat.name }}</a></td>
                            <td><a href="{{ route('residence.tenant.show', [residence.id, contract.tenant.id]) }}" title="{{ contract.tenant.full_name }}">{{ contract.tenant.full_name }}</a></td>
                            <td>
                                <a href="{{ route('residence.contract.show', [residence.id, contract.id]) }}" title="{{ trans('global.lbl.show') }}" class="btn btn-xs btn-default pull-right">{{ trans('global.lbl.show') }}</a>
                            </td>
                        </tr>

                    {% else %}

                        <tr>
                            <td colspan="8" class="text-danger">{{ trans('global.contract.no_booked') }}</td>
                        </tr>

                    {% endfor %}

                </table>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">{{ trans_choice('global.contract.incomplete', 2) }}</div>
                <table class="table text-center">

                    <thead>
                    <tr>
                        <th class="text-center">#</th>
                        <th class="text-center">{{ trans_choice('global.flat.title', 1) }}</th>
                        <th class="text-center">{{ trans_choice('global.tenant.title', 1) }}</th>
                        <th class="text-center"></th>
                    </tr>
                    </thead>

                    {% for contract in incomplete_contracts if incomplete_contracts is not empty%}

                        <tr>
                            <td>{{ loop.index }}</td>
                            <td><a href="{{ route('residence.flat.show', [residence.id, contract.flat.id]) }}" title="{{ contract.flat.name }}">{{ contract.flat.name }}</a></td>
                            <td><a href="{{ route('residence.tenant.show', [residence.id, contract.tenant.id]) }}" title="{{ contract.tenant.full_name }}">{{ contract.tenant.full_name }}</a></td>
                            <td>
                                <a href="{{ route('residence.contract.show', [residence.id, contract.id]) }}" title="{{ trans('global.lbl.show') }}" class="btn btn-xs btn-default pull-right">{{ trans('global.lbl.show') }}</a>
                            </td>
                        </tr>

                    {% else %}

                        <tr>
                            <td colspan="8" class="text-danger">{{ trans('global.contract.all_complete') }}</td>
                        </tr>

                    {% endfor %}

                </table>
            </div>
        </div>

        <script>
            var ctx = document.getElementById("myChart");
            var ctx2 = document.getElementById("myChart2");
            var ctx3 = document.getElementById("myChart3");

            var data_flats = {
                labels: [
                    "{{ trans('global.flat.full') }}",
                    "{{ trans_choice('global.flat.empty_not_relet', 2) }}",
                    "{{ trans_choice('global.flat.empty_relet', 2) }}"
                ],
                datasets: [
                    {
                        data: [{{ nb_occupied_flats }}, {{ nb_empty_flats_not_relet }}, {{ nb_empty_flats_relet }}],
                        backgroundColor: [
                            "#BEDB39",
                            "#FF5347",
                            "#FFCF00"
                        ],
                        hoverBackgroundColor: [
                            "#BEDB39",
                            "#FF5347",
                            "#FFCF00"
                        ]
                    }]
            };

            var data_contracts = {
                labels: [
                    "{{ trans('global.contract.complete') }}",
                    "{{ trans_choice('global.contract.incomplete', 2) }}"
                ],
                datasets: [
                    {
                        data: [{{ nb_contracts_without_required_documents }}, {{ nb_contracts_with_required_documents }}],
                        backgroundColor: [
                            "#BEDB39",
                            "#FF5347"

                        ],
                        hoverBackgroundColor: [
                            "#BEDB39",
                            "#FF5347"
                        ]
                    }]
            };

            var data_tenants = {
                labels: [
                    "{{ trans_choice('global.tenant.new', 2) }}",
                    "{{ trans_choice('global.tenant.old', 2) }}",
                    "{{ trans_choice('global.tenant.passenger', 2) }}"
                ],
                datasets: [
                    {
                        data: [{{ nb_new_tenants }}, {{ nb_old_tenants }}, {{ nb_passenger_tenants }}],
                        backgroundColor: [
                            "#BEDB39",
                            "#1F8A70",
                            "#FF5347"
                        ],
                        hoverBackgroundColor: [
                            "#BEDB39",
                            "#1F8A70",
                            "#FF5347"
                        ]
                    }]
            };

            var myPieChart = new Chart(ctx,{
                type: 'pie',
                data: data_flats,
                options: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                }
            });

            var myPieChart = new Chart(ctx2,{
                type: 'pie',
                data: data_contracts,
                options: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                }
            });

            var myPieChart = new Chart(ctx3,{
                type: 'pie',
                data: data_tenants,
                options: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                }
            });

        </script>

{% endblock %}